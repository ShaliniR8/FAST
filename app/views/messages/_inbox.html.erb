<%=render "access_controls/new_modal"%>
<%=render "shared/alerts" %>
<div class="panel panel-steelblue">
  <div class="panel-heading">
    <div class="panel-title">
      <div class="top_text">
        <%=@message.subject%>
      </div>
      <div class="top_buttons pull-right">
        <% if @title.present? %>
          <%=link_to "Delete",
            message_path(@message, :source => @title),
            :method => "delete",
            :class => "btn btn-danger pull-right",
            :id => "destroy-btn",
            :remote => true%>
        <%end%>
        <%=link_to "Reply", "#",
          :class => "btn btn-warning pull-right mr5",
          :disable_with => 'Replying...',
          :id => "rep-btn"%>
        <%#=link_to "View Dialogs", "#",
          :class => "btn btn-info pull-right mr5",
          :id => "dialog-btn"%>
      </div>
    </div>
  </div>

  <div class="panel-body">
    <div id="view_dialog"></div>
    <div id="current_message">
      <%=render "message", :message => @message%>
    </div>
    <div id="view_prev"></div>
  </div>
</div>





<script>
  $(document).ready(function(){
    $('#fwd-btn').on("click",function(){
      window.open("<%=new_message_path(@message)%>",'popup','width=600,height=600');
    });
    $('#rep-btn').on("click",function(){
      window.document.location = "<%=new_message_path(:reply_to=>@message.id)%>";
    });
    $("#dialog-btn").on("click", function(){
      $.get("<%=reply_message_path(@message.id)%>", function(data){
        $("#view_dialog").html(data);
      });
      $.get("<%=prev_message_path(@message.id)%>", function(data){
        $("#view_prev").html(data);
      });
    });
    $('#destroy-btn').on('click',function(){
      $(document).ajaxSuccess(function(){
        location.reload();
      });
    });
  });
</script>
