<div class="table-responsive mt10">
  <table id="users" class="table table-hover">
    <thead>
      <tr>
        <%@headers.each do |header|%>
          <th class="<%=header[:size]%>">
            <%=header[:title]%>
          </th>
        <%end%>
          <th class="col-xs-3 col-lg-3">Status</th>
      </tr>
    </thead>
    <tbody>
      <%@users.each do |user|%>
        <tr user="<%=user.id%>">
          <%@headers.each do |header|%>
            <td><%=user.send(header[:field])%></td>
          <%end%>
          <%if @action=="new"%>
            <td><a class="btn btn-info invite_btn">Invite</a></td>
          <%elsif @action=="show"%>
            <td><%=user.get_invitation_status @meeting%></td>
          <%else%>
            <%if (user.get_invitation_status @meeting)=="Not Invited"%>
              <td><a class="btn btn-info invite_btn">Invite</a></td>
            <%else%>
              <td><a class="btn btn-success invite_btn">Invited</a></td>
            <%end%>
          <%end%>
        </tr>
      <%end%>
    </tbody>
  </table>
</div>
<style>
.table th {
  text-align: center;
}

.table td {
  text-align: center;
}
</style>


<script>
  $(document).ready(
    function(){
      $(".invite_btn").on("click",function(){
        if ($(this).text()=="Invite")
        {
          $(this).text("Invited");
          $(this).removeClass("btn-info").addClass("btn-success");
        }
        else
        {

          $(this).text("Invite");
          $(this).removeClass("btn-success").addClass("btn-info");

        }
      });
      var dt=$('#users').DataTable({
          "aLengthMenu": [[5, 10, 15, -1], [5, 10, 15, "All"]],
          "iDisplayLength": 5
      });
      $('form').on('submit',function(){
        var count=0;
        var form=$(this);
        dt.rows().nodes().to$().each(function(){
          //console.log(count+"="+$(this).attr("user"));
          if ($(this).find(".invite_btn").text()=="Invited")
          {
            form.append('<input type="hidden" name=meeting[invitations_attributes]['+count+ '][users_id] value='+$(this).attr("user")+'>');
            count++;
          }
        });
        return true;
      });
    }
  );
</script>
