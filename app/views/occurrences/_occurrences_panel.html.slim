ruby:
  show_btns ||= %w[New Assigned].include?(owner.status) &&
    current_user.has_access(owner.class, 'Edit', admin: true)

.col-xs-12
  .panel.panel-lightskyblue
    .panel-heading.click-heading.collapsed
      .panel-title
        b Occurrences
        span class="pull-right clickable"
          i class="mt5 glyphicon glyphicon-chevron-down"
    .panel-body style="display:none;"
      .row.col-xs-12
        - if show_btns
          = link_to 'Add Occurrence',
            '#',
            class: 'btn btn-success pull-right mr5',
            id: 'add_occurrence_btn'
      .row.col-xs-12
        table.table.table-striped.table-bordered width="100%"
          thead
            tr
              - Occurrence.get_meta_fields('index').each do |header|
                th =header[:title]
              - if show_btns
                th Action
          tbody
            - owner.occurrences.each do |occurrence|
              tr
                - Occurrence.get_meta_fields('index').each do |header|
                  td =render '/forms/show_field', :field_hash => header, :record => occurrence
                - if show_btns
                  td =link_to 'Delete', '#',
                  class: 'btn btn-danger delete_occurrence_btn',
                  'data-cid' => occurrence.id
javascript:
  $(function(){
    $('#add_occurrence_btn').on('click', function(){
      $.get('#{new_occurrence_path}?owner_id=#{owner.id}&owner_type=#{owner.class.name}',
        function(data){
          $(".modal-content").html(data);
          $(window).trigger('resize');
        });
    });
  })

  $('.delete_occurrence_btn').click(function(){
    if(confirm('Are you sure?')){
      btn = $(this)
      $.ajax({
        url: "#{occurrences_path}/" + $(this).data('cid'),
        type: 'delete',
        success: function(){
          btn.closest('tr').detach()
        }
      })
    }
  })
