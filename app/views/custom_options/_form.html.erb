<script type="text/javascript" src="/javascripts/utility/extra_fields.js"></script>
<%=form_for @record do |f|%>
	<div class="panel panel-warning">
		<div class="panel-heading">
			<div class="panel-title"><b><%=controller.action_name.titleize%> Custom Option</b>
			<button type="button" class="close pull-right" data-dismiss="modal" aria-label="Close"><span class="glyphiconglyphicon-remove"></span></button></div>
		</div>
		<div class="panel-body">
			<div class="row" style="max-height:500px;overflow-y:auto;">
				<div class="form-group col-xs-6">
					<%= f.label :title, "Title" %>
					<%= f.text_field :title, :class => "form-control ml5", :readonly => false %>
				</div>
				<div class="form-group col-xs-12">
					<%= f.label :description, "Description" %>
					<%= f.text_field :description, :class => "form-control ml5", :readonly => false %>
				</div>
				<div class="form-group col-xs-12">
					<%= f.label :options, "Options"%>
					<%= f.hidden_field :options, :id => "options_submit"%>
					<%= link_to 'Add Option', '#', :class=>'btn btn-success pull-right', :id=>"add_btn"%>
					<div id="options">
					</div>
				</div>
				
				<%=f.submit "Save",:class=>"btn btn-success pull-right mt5 mr15", disable_with: "Saving..."%>
				<%if controller.action_name == "edit" && false%>
					<%= link_to "Delete", custom_option_path(@record), :method=>"delete", :confirm=>'Please confirm that you want to delete this custom option. The deletion cannot be reverted',:class=>"btn btn-danger pull-right mt5 mr5"%>
				<%end%>
			</div>
		</div>
	</div>
<%end%>





<script>

	function remove_window_btn(btn){
		$(btn).parent().parent().detach();
	}

	var option_html = 
		"<div class='option_entry'>" +
			"<div class='form-group form-inline col-xs-8'>" +
				"<%=escape_javascript(text_field_tag :option, nil, :class => 'form-control option ml5')%>" +
			"</div>" +
			"<div class='col-xs-2'>" +
				"<%=escape_javascript(link_to 'X', '#', :class=>'btn btn-danger pull-right', :onclick => 'remove_window_btn(this)')%>" +
			"</div>"+
		"</div>";



	$(function(){


		$("form").on("submit", function(){
			$("#options_submit").val("");
			$(".option_entry").each(function(){
				option = $(this).find(".option").val();
				if(option != ""){
					if($("#options_submit").val() == ""){
						$("#options_submit").val(option);
					}else{
						$("#options_submit").val($("#options_submit").val()+";"+option);
					}
				}
			});
		});


		$("#add_btn").on("click", function(){
			$("#options").append(option_html);
		});


		<%if @record.options.present?%>
			<% @options = @record.options.split(";")%>
			<%length = @options.length%>
			<%for i in 0..length-1 %>
				option_insert = 
					"<div class='option_entry'>" +
						"<div class='form-group form-inline col-xs-8'>" +
							"<%=escape_javascript(text_field_tag :option, @options[i], :class => 'form-control option ml5')%>" +
						"</div>" +
						"<div class='col-xs-2'>" +
							"<%=escape_javascript(link_to 'X', '#', :class=>'btn btn-danger pull-right', :onclick => 'remove_window_btn(this)')%>" +
						"</div>"+
					"</div>";
					$("#options").append(option_insert);
			<%end%>
		<%end%>

	});
</script>