<%if owner.tasks.present?%>
  <div class="col-xs-12 col-lg-12"%>
    <div class="panel panel-info">
      <div class="panel-heading click-heading collapsed">
        <div class="panel-title">
          <b>Tasks</b><span class="pull-right clickable"><i class="mt5 glyphicon glyphicon-chevron-down"></i></span>
        </div>
      </div>
      <div class="panel-body" style="display:none">
        <div class="row">
          <%owner.tasks.each do |task|%>
            <% task_edit_access = current_user.has_access(task.owner.rule_name, "edit", admin: CONFIG::GENERAL[:global_admin_default]) || (task.related_users.include? current_user.id) %>
            <div class="col-xs-12">
              <div class="panel panel-info">
                <div class="panel-heading click-heading collapsed">
                  <div class="panel-title">
                      <b>#<%=task.id%> <%=task.title%></b><span class="pull-right clickable"><i class="mt5 glyphicon glyphicon-chevron-down"></i></span>
                  </div>
                </div>
                <div class="panel-body" style="display:none">
                  <div class="row">
                    <%=render '/forms/show_fields',
                      :fields => fields,
                      :record => task
                    %>


                    <div class='col-xs-12'>
                      <% if task_edit_access %>
                        <%if task.status == 'New'%>
                          <%=link_to 'Assign', '#', class: 'edit-task-btn btn btn-warning pull-right mr5',
                            'data-path' => edit_sms_task_path(task, :commit => 'Assign'),
                            'data-toggle' => 'modal',
                            'data-target' => '.bs-example-modal-lg'%>
                        <%end%>
                        <%if task.status == 'Assigned'%>
                          <%=link_to 'Complete', '#', class: 'edit-task-btn btn btn-warning pull-right mr5',
                            'data-path' => edit_sms_task_path(task, :commit => 'Complete'),
                            'data-toggle' => 'modal',
                            'data-target' => '.bs-example-modal-lg'%>
                        <%end%>
                        <%if task.status == 'Pending Approval'%>
                          <%=link_to 'Reject', '#', class: 'edit-task-btn btn btn-danger pull-right mr5',
                            'data-path' => edit_sms_task_path(task, :commit => 'Reject'),
                            'data-toggle' => 'modal',
                            'data-target' => '.bs-example-modal-lg'%>
                          <%=link_to 'Approve', '#', class: 'edit-task-btn btn btn-success pull-right mr5',
                            'data-path' => edit_sms_task_path(task, :commit => 'Approve'),
                            'data-toggle' => 'modal',
                            'data-target' => '.bs-example-modal-lg'%>
                        <%end%>
                        <%if !['Pending Approval', 'Completed'].include? owner.status%>
                          <%=link_to 'Edit', '#', class: 'edit-task-btn btn btn-warning pull-right mr5',
                            'data-path' => edit_sms_task_path(task),
                            'data-toggle' => 'modal',
                            'data-target' => '.bs-example-modal-lg'%>
                          <%=link_to 'Delete', sms_task_path(task),
                            method: 'delete', confirm: 'Are you sure?',
                            class: 'btn btn-danger pull-right mr5'%>
                        <%end%>
                      <%end%>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          <%end%>
        </div>
      </div>
    </div>
  </div>
<%end%>


<script>
  $('.edit-task-btn').on('click', function(){
    $.get($(this).data('path'), function(data){
      $('.modal-content').html(data);
      $(window).trigger('reszie');
    });
  });
</script>

