<%if owner.checklist_records.present?%>
  <%headers = ChecklistRecord.get_meta_fields("show")%>
  <div class="col-xs-12">
    <div class="panel panel-lightskyblue">
      <div class="panel-heading click-heading">
        <div class="panel-title">
          Checklist
          <span class="pull-right clickable"><i class="mt5 glyphicon glyphicon-chevron-down"></i></span>
        </div>
      </div>
      <div class="panel-body">
        <%=link_to "Download Checklist",
          download_records_checklist_templates_path(
            :owner_id => owner.id,
            :owner_class => owner.class.name,
            :format => "csv"),
          :class => "btn btn-info pull-right mb10 ml5",
          :target => "_blank"%>

        <%=link_to "Update Checklist",
          "#",
          :class => "btn btn-warning pull-right mb10",
          :id => "update_checklist_records_btn",
          "data-toggle" => "modal",
          "data-target" => ".bs-example-modal-lg"%>


        <table id="checklist_records" class="table table-bordered">
          <thead>
            <tr>
              <%headers.each do |h|%>
                <th style="width:<%=h[:width]%>%"><%=h[:title]%></th>
              <%end%>
            </tr>
          </thead>
          <tbody>
            <%owner.checklist_records.each do |record|%>
              <tr style="<%=record.header? ? 'background-color:whitesmoke;font-weight:bold' : ''%>">
                <%headers.each do |h|%>
                  <%value = record.send(h[:field])%>
                  <%case value%>
                  <%when "Yes"%>
                    <%color_class = "green-bg"%>
                  <%when "No"%>
                    <%color_class = "red-bg"%>
                  <%when "N/A"%>
                    <%color_class = "gray-light-bg"%>
                  <%else%>
                  <%end%>
                  <td class="<%=color_class%>"><%=value%></td>
                <%end%>
              </tr>
            <%end%>
          </tbody>
        </table>
      </div>
    </div>
  </div>
<%end%>


<script>
  //$('#checklist_records').dataTable();

  $("#update_checklist_records_btn").on("click", function(){
    $.get("/<%=owner.class.table_name%>/<%=owner.id%>/update_checklist_records", function(data) {
      $(".modal-content").html(data);
      $(window).trigger("resize");
    });
  });
</script>
