<script type="text/javascript" src="/javascripts/utility/format-builder.js"></script>
<script type="text/javascript" src="/javascripts/utility/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/javascripts/utility/dataTables.bootstrap.min.js"></script>
<script type="text/javascript" src="/javascripts/utility/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="/javascripts/utility/nested_fields.js"></script>
<script type="text/javascript" src="/javascripts/utility/collapse-panel2.js"></script>
<script type="text/javascript" src="/javascripts/utility/validate-form.js"></script>
<script type="text/javascript" src="/javascripts/utility/delete.js"></script>
<script type="text/javascript" src="/javascripts/utility/extra_fields.js"></script>
<link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap/dataTables.bootstrap.min.css"/>


<div class="item active mt50" style="height:auto;">
  <div class="grid per90 center-block">
    <%=render "shared/alerts" %>

    <div class="panel panel-warning">
      <div class="panel-heading">
        <div class="panel-title">
          <%="#{action_name.titleize} Audit"%>
        </div>
      </div>

      <div class="panel-body" id="form_body">
        <%=form_for @owner, :html => {:multipart => true} do |f|%>
        <% if CONFIG::GENERAL[:display_workflow_diagram] %>
        <div class="col-xs-12">
            <%instruction = "<p>"
              instruction = instruction + "<button id ='toggleWorkflowImageButton' type='button' class='btn btn-light' >Show Workflow Image</button>"
              instruction = instruction + "</p>"
              instruction = instruction + "<img id='workflowImage' class = 'workflowImg' height=800 width= 100% src = ''>"
            %>
            <%=render "shared/instructions",
              :instruction => instruction%>
          </div>
          <% end %>
          <%if action_name == "new"%>
            <%=f.hidden_field :created_by_id, :value => current_user.id%>
            <%=f.hidden_field :parent_type, :value => @parent_type%>
            <%=f.hidden_field :parent_id,   :value => @parent_id%>
          <%end%>
          <%=render "shared/privilege_form",
            :target => "audit[privileges][]", :owner => @owner, :f => f%>
          <%=render '/forms/form_fields', :f => f, :fields => @fields, :record => @owner %>
          <% if CONFIG.sa::GENERAL[:non_recurring_item_checklist] %>      
            <%=render '/forms/checklist_templates'%>
          <%end%>  
          <%=render '/forms/attachments_form', :f => f, :owner => @owner%>

          <div class="mt10 mr10">
            <%= f.submit "#{action_name == 'new' ? 'Submit' : 'Update'}",
              :class => "btn btn-success pull-right",
              :disable_with => "Saving..."%>

            <%=link_to "Cancel",
              action_name == 'new' ? audits_path : audit_path(@owner),
              :id => "cancel-btn",
              :class => "mr5 btn btn-default pull-right",
              :confirm => 'Are you sure?'%>

            <%#=link_to "Group Access",
              "#",
              :class => "mr5 btn btn-info pull-right",
              "data-toggle" => "modal",
              "data-target" => "#group_access"%>
          </div>

        <%end%>
      </div>
    </div>
  </div>
</div>

<style>
  #workflowImage{
    display: none;
    width: 100%;
    height: auto;
    padding: 4%;%
  }
</style>

<script> 

  $("#toggleWorkflowImageButton").on('click', function(event){
    event.preventDefault();
    <% if CONFIG::GENERAL[:display_workflow_diagram] && action_name == 'new' %>
        $("#workflowImage").attr('src', '<%= "/images/workflow_diagram/#{AIRLINE_CODE}/#{@owner.class.name}_#{action_name}.png" %>')
    <% end %>

    <% if CONFIG::GENERAL[:display_workflow_diagram] && action_name == 'edit' %>
      $("#workflowImage").attr('src', '<%= "/images/workflow_diagram/#{AIRLINE_CODE}/#{@owner.class.name}_#{@owner.status.downcase.parameterize.underscore}.png" %>')
    <% end %>

    if($("#workflowImage").is(":visible")){
      $("#workflowImage").delay(1).hide("slow")
      $("#toggleWorkflowImageButton").html("Show Workflow Image")
    }else{
      $("#workflowImage").delay(1).show("slow")
      $("#toggleWorkflowImageButton").html("Hide Workflow Image")
    }
});
</script>
