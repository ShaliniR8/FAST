<div class="panel panel-warning">
	<div class="panel-heading">
		<div class="panel-title">
			<b>Agenda/Notice</b><button type="button" class="close pull-right" data-dismiss="modal" aria-label="Close"><span class="glyphicon glyphicon-remove"></span></button>
		</div>
	</div>
	<%=form_tag send_message_meeting_path(@meeting),:method=>"post",:multipart => true,:class=>"form-horizontal" do%>
		<div class="panel-body" style="max-height: calc(100vh - 210px);overflow-y:auto">
			<div class="row">
				<div id="send_to_group">
					<%=label_tag :send_to,"To",:class=>"control-label col-xs-2 col-sm-1"%>
					<div class="col-xs-5 col-sm-4 col-lg-3">
						<%=select_tag :send_to, options_for_select(@options),{:include_blank=>true,:class=>"form-control"}%>         		
					</div>
				</div>
				<div class="col-xs-3 col-sm-2 col-lg-2">
					<%=link_to "Select Invitees","#",{:class=>"btn btn-warning pull-left drop",:id=>"inv_btn"}%>
				</div>
			</div>
			<div class="row mt5" style="display:none" id="invitee_table">
				<div class="col-lg-12">
					<div class="table-responsive">
						<table id="notice_users" class="table table-bordered">
							<thead>
								<tr>
									<%@headers.each do |header|%>
										<th class="<%=header[:size]%>">
											<%=header[:title]%>
										</th>
									<%end%>
										<th class="col-xs-3 col-lg-3">Status</th>
								</tr>
							</thead>
							<tbody>
								<%@users.each do |user|%>
									<tr user="<%=user.id%>">
								<%@headers.each do |header|%>
									<td><%=user.send(header[:field])%></td>
								<%end%>
								<td><a class="btn btn-info select_btn">Select</a></td>
									</tr>
								<%end%>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="row mt5">
				<%=label_tag :subject,"Subject",:class=>"control-label col-xs-2 col-sm-1"%>
				<div class="col-xs-10 col-lg-11">
					<%=text_field_tag :subject,nil,{:class=>"form-control"}%>         		
				</div>
			</div>
			<div class="row mt5">
				<%=label_tag :message,"Message",:class=>"control-label col-xs-2 col-sm-1"%>
				<div class="col-xs-10 col-lg-11">
					<%=text_area_tag :message,nil,{:class=>"form-control",:rows=>"15"}%>         		
				</div>
			</div>
			<div class="row mt5">
				<%=label_tag :att,"Attachment",:class=>"control-label col-xs-2 col-sm-1"%>
				<div class="col-xs-4 col-lg-4">
					<%=file_field_tag :att%>         		
				</div>
			</div>
			<div class="row mt5">
				<%=submit_tag "Send",:class=>"pull-right col-sm-1 btn btn-success mr15"%>
			</div>
		</div>
	<%end%>
</div>



<script>
	$(document).ready(function(){

		$("#inv_btn").on('click',function(){
			if ($(this).hasClass("drop")){
				$("#send_to_group").hide();
				$(this).text("Select Group");
				$(this).removeClass("drop");
				$("#invitee_table").show();
			}else{
				$(this).addClass("drop");
				$("#invitee_table").hide();
				$(this).text("Select Invitees");
				$("#send_to_group").show();
			}
		});

		$(".select_btn").on("click",function(){
			if ($(this).text()=="Select"){
				$(this).text("Selected");
				$(this).removeClass("btn-info").addClass("btn-success");
			}else{
				$(this).text("Select");
				$(this).removeClass("btn-success").addClass("btn-info");
			}
		});

		var dt = $('#notice_users').DataTable({
											"aLengthMenu": [[5, 10, 15, -1], [5, 10, 15, "All"]],
											"iDisplayLength": 5
		});

		$('form').on('submit',function(){
			var count = 0;
			var form = $(this);
			dt.rows().nodes().to$().each(function(){
				if ($(this).find(".select_btn").text()=="Selected"){
					form.append('<input type="hidden" name=message_to['+count+ '] value='+$(this).attr("user")+'>');
					count++;
				}
			});
			return true;
		});
	});
</script>
