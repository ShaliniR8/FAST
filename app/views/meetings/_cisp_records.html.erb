<div class="panel panel-warning">
  <div class="panel-heading">
    <div class="panel-title">CISP Reports
      <button type="button"
        class="close pull-right"
        data-dismiss="modal"
        aria-label="Close">
        <span class="glyphicon glyphicon-remove"></span>
      </button>
    </div>
  </div>
  <div class="panel-body">
    <div class="row col-xs-12 table-responsive">
      <table id="cisp_reports" class="table table-striped table-bordered">
        <thead>
          <tr>
            <%@record_headers.each do |h|%>
              <th><%=h[:title]%></th>
            <%end%>
          </tr>
        </thead>
        <tbody>

          <%@records.each do |u|%>
            <tr uid="<%=u.id%>">
              <%@record_headers.each do |h|%>
                <td class="<%=h[:html_class].present? ? u.send(h[:html_class]) : ''%>">
                  <%case h[:type]%>
                  <%when 'date'%>
                    <%=u.send(h[:field]).strftime("%Y-%m-%d") rescue ''%>
                  <%when 'datetime'%>
                    <%=u.send(h[:field]).strftime("%Y-%m-%d %H:%M") rescue ''%>
                  <%when 'textarea'%>
                    <%=u.send(h[:field]).gsub(/\n/, '<br/>').html_safe rescue ''%>
                  <%else%>
                    <%if sent && h[:field] == "get_status"%>
                      <b style="color:red;"">Sent</b>
                    <%else%>
                      <%=u.send(h[:field])%>
                    <%end%>
                  <%end%>
                </td>
              <%end%>
            </tr>
          <%end%>

        </tbody>
      </table>
    </div>
    <%if not sent%>
      <button type="button" id="send_to_cisp" class="btn btn-warning pull-right mt10">Sent to CISP</button>
    <%end%>
  </div>
</div>

<script>
  $(document).ready(function(){

    $('#cisp_reports').DataTable({
      destroy: true,
      "aLengthMenu": [[5, 10, 15, -1], [5, 10, 15, "All"]],
      "iDisplayLength": 5
    });

    $('#send_to_cisp').on('click',function(){
      console.log('here')
      $.get("<%=send_cisp_records_meeting_path(@meeting)%>", function(data){
        $(".modal-content").html(data);
        $(window).trigger('resize');
      });
    });

  });
</script>
