<script type="text/javascript" src="/javascripts/utility/collapse-panel2.js"></script>
<script type="text/javascript" src="/javascripts/utility/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="/javascripts/utility/format-builder.js"></script>
<link rel="stylesheet" type="text/css" href="/stylesheets/datepicker.css"/>
<div class="item active mt50" style="height:auto;">
  <div class="grid per90 center-block">
    <%=render "shared/alerts"%>
    <div class="col-lg-12">
      <div class="panel panel-primary">
        <div class="panel-heading">
          <div class="panel-title">
            <b><%="#{@record.template.name}"%> Submission #<%=@record.get_id%>: <%="#{@record.get_description}"%> </b>
            <div class="top_buttons pull-right">
              <a class="btn btn-warning expandall mb5">Expand All</a>
              <%if current_user.has_template_access(@record.template.name).include?("full") || current_user.has_template_access(@record.template.name).include?("viewer")%>
                <%if !@record.anonymous?%>
                  <%=link_to "Message Submitter", new_message_path(:send_to => @record.created_by.id,:link=>submission_path(@record)), :id=>"index-btn", :class=>"btn btn-warning mb5"%>
                <%end%>
                <%=link_to "Send Message",new_message_path(:link=>submission_path(@record), :link_type=>"Submission", :link_id=>@record.id),:class=>"btn btn-warning mb5"%>
                <%if @record.record.present?%>
                  <%=link_to "View Report",record_path(@record.record),:class=>"btn btn-info mb5", :disable_with => "Redirecting..."%>
                <%end%>
                <%=link_to "PDF", print_full_submission_path(@record,format: :pdf),:class=>'btn btn-info mb5'%>
                <%=link_to "De-Identified PDF", print_submission_path(@record,format: :pdf),:class=>'btn btn-info mb5'%>

                <%if current_user.has_access("submissions","destroy")%>
                  <%=link_to 'Delete', submission_path(@record), :method=>"delete", :confirm=>'Please confirm that you want to delete this submission. The deletion cannot be reverted',:class=>"btn btn-danger mb5"%>
                <%end%>
              <%end%>
            </div>
          </div>
        </div>
        <div class="panel-body collapse in" id="form_body">
          <div class="row mb10">
            <%if current_user.id == @record.created_by.id%>
              <span data-toggle="modal" data-target=".bs-example-modal-lg">
                <%=link_to "Add Additional Notes","#",
                      :class=>"btn btn-success pull-right mr10 mb5",:id=>'comment_btn',
                      "data-toggle"=>"tooltip", "data-placement"=>"top", :title=>"Add additional notes. Analysts will be notified when new notes are added."%>
              </span>

            <%end%>

          </div>
          <div class="row" style="overflow-x:hidden;overflow-y:auto;max-height: 600px">
            <%=render "access_controls/new_modal"%>

            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-12 mb10" style="word-wrap: break-word">
              <b>Submission ID: </b><%=@record.get_id%></br>
              <%if !@record.anonymous?%><b>Submitted By: </b><%=@record.created_by.full_name%></br><%end%>
              <b>Date/Time of Event: </b><%=@record.get_event_date%>  <%if CONFIG.sr::GENERAL[:submission_time_zone]%><%=@record.event_time_zone%><%end%></br>
              <%if CONFIG.sr::GENERAL[:submission_description]%><b>Title: </b><%=@record.description%></br><%end%>
            </div>

            <%if @record.comments.present?%>
              <div class="col-xs-12 col-lg-12"%>
                <div class="panel panel-info">
                  <div class="panel-heading click-heading collapsed">
                    <div class="panel-title">
                      <b>Additional Notes</b><span class="pull-right clickable"><i class="mt5 glyphicon glyphicon-chevron-down"></i></span>
                    </div>
                  </div>
                  <div class="panel-body" style="display:none">
                    <div class="row">
                        <%=render "show_notes",:owner=>@record%>
                    </div>
                  </div>
                </div>
              </div>
            <%end%>

            <%@record.categories.order(:category_order).each do |c|%>
              <%@cat=c%>
              <%if @cat.id == 338%>
                <%=render "show_observation_phases_category"%>
              <%elsif @cat.not_empty_for(@record)%>
                <%=render "category"%>
              <%end%>
            <%end%>


            <%=render "/forms/attachments_show", :owner => @record%>
            <%=render "/records/transactions",{:owner=>@record}%>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
  $(document).ready(function(){
    $('#comment_btn').on('click',function(){
      $.get("<%=comment_submission_path(@record)%>",function(data){
        $(".modal-content").html(data);
        $(window).trigger('resize');
      });
    });
  });


</script>
