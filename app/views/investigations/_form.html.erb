<script type="text/javascript" src="/javascripts/utility/format-builder.js"></script>
<script type="text/javascript" src="/javascripts/utility/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/javascripts/utility/dataTables.bootstrap.min.js"></script>
<script type="text/javascript" src="/javascripts/utility/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="/javascripts/utility/nested_fields.js"></script>
<script type="text/javascript" src="/javascripts/utility/collapse-panel2.js"></script>
<script type="text/javascript" src="/javascripts/utility/validate-form.js"></script>
<script type="text/javascript" src="/javascripts/utility/delete.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.js"></script>
<link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap/dataTables.bootstrap.min.css"/>

<div class="item active mt50" style="height:auto;">
  <div class="grid per90 center-block">
    <div class="panel panel-warning">
      <div class="panel-heading">
        <div class="panel-title">
          <%=action_name.titleize%> Investigation
        </div>
      </div>
      <div class="panel-body" id="form_body">
        <%=form_for @owner ,:html => {:multipart => true} do |f|%>
          <%if action_name == "new"%>
            <%=f.hidden_field :created_by_id, :value => current_user.id%>
            <%=f.hidden_field :parent_type, :value => @parent_type%>
            <%=f.hidden_field :parent_id,   :value => @parent_id%>
          <%end%>
          <%if params[:owner_id].present? && params[:owner_type].present? %>
            <%=f.hidden_field :owner_id,   :value => params[:owner_id] %>
            <%=f.hidden_field :owner_type, :value => params[:owner_type] %>
            <%=f.hidden_field :parent_type, :value => @parent_type%>
            <%=f.hidden_field :parent_id,   :value => @parent_id%>
          <%end%>
          <%=render "/shared/privilege_form", :target => "investigation[privileges][]", :owner => @owner, :f => f%>
          <%=render '/forms/form_fields', :f => f, :fields => @fields, :record => @owner %>

          <%=render "shared/choose_form_matrix", :f => f, :type => 'investigations', :owner => @owner%>

          <%=render '/forms/attachments_form', :f => f, :owner => @owner%>
          <div class="mt10 mr10">
            <%= f.submit "#{action_name == 'new' ? 'Submit' : 'Update'}",
              :class => "btn btn-success pull-right",
              :disable_with => "Saving..."%>
            <%=link_to "Cancel",
              action_name == "edit" ? investigation_path(@owner): @cancel_path,
              :id => "cancel-btn",
              :class => "mr5 btn btn-warning pull-right",
              :confirm => 'Are you sure?'%>
            <%=link_to "Group Access",
              "#",
              :class => "mr5 btn btn-info pull-right",
              "data-toggle" => "modal",
              "data-target" => "#group_access"%>
          </div>
        <%end%>
      </div>
    </div>
  </div>
</div>


<style>
  .datepicker{
    z-index: 1200;
  }
  td,th{
    text-align: center;
  }
</style>



<script>
  $(document).ready(function(){
    $("#<%=@owner.severity%>-<%=Investigation.get_likelihood.index(@owner.likelihood)%>").html("<span class='glyphicon glyphicon-remove' style='color:red'></span>");
    $('#sev').on('change',function(){
      reset_risk();
    });
    $('#like').on('change',function(){
      reset_risk();
    });
    $(".basic-datepicker").datepicker({format: "YYYY-MM-DD"}).on('focus', function() {
      $(this).trigger('blur');
    });
  });
</script>

