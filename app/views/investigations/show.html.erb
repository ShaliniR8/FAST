<script type="text/javascript" src="/javascripts/utility/collapse-panel2.js"></script>
<script type="text/javascript" src="/javascripts/utility/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/javascripts/utility/dataTables.bootstrap.min.js"></script>
<script type="text/javascript" src="/javascripts/utility/dataTables.buttons.min.js"></script>
<link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap/dataTables.bootstrap.min.css"/>
<script type="text/javascript" src="/javascripts/utility/format-builder.js"></script>

<div class="item active mt50" style="height:auto;">
  <div class="grid per90 center-block">
    <%=render "shared/alerts"%>
    <%=render "access_controls/new_modal"%>
    <div class="col-xs-12">
      <div class="panel panel-primary">
        <div class="panel-heading">
          <div class="panel-title">
            <div class="top_text">
              Investigation #
              <%=@investigation.get_id%>:
              <%=@investigation.title%>
            </div>
            <div class="top_buttons pull-right">

              <%= render '/forms/btns/render_btns',
                btns: [
                  'delete',
                  'override_status',
                  'edit',
                  'deid_pdf',
                  'pdf',
                  'view_report'
                  'viewer_access',
                  'send_message',
                  'expand_all'
                ],
                owner: @investigation %>

            </div>
          </div>
        </div>
        <div class="panel-body">
          <div class="col-xs-12 mb15">

            <%= render '/forms/btns/render_btns',
              btns: [
                'assign',
                'complete',
                'approve_reject',
                'reopen',
                'recommendation',
                'contact',
                'task',
                'cost',
                'sms_action',
                'finding',
                'comment'
              ],
              owner: @investigation %>

          </div>

          <%=render '/forms/show_fields', :fields => @fields, :record => @investigation %>

          <%if BaseConfig.airline[:base_risk_matrix]%>
            <%=render "shared/bsk_risk_matrix_show",
            :owner => @investigation,
            :type => "investigations",
            :like => @like,
            :color_matrix => @color_matrix,
            :frequency => @frequency,
            :allow_mitigate => true,
            :show_btns => true%>
          <%else%>
            <%=render "shared/#{BaseConfig.airline[:code]}/show_matrix",
            :owner=>@investigation,
            :allow_mitigate => true,
            :show_btns => true%>
          <%end%>


          <%can_change = @investigation.status != "Completed" &&
            @investigation.status != "Pending Approval" &&
            current_user.has_access("investigations","edit")%>
          <%=render '/causes/all',
            :owner => @investigation,
            :cause_type => 'description',
            :can_change => can_change%>
          <%=render '/causes/all',
            :owner => @investigation,
            :cause_type => 'cause',
            :can_change => can_change%>

          <%=render '/findings/show_all', :owner => @investigation, :show_btn => false%>
          <%=render '/sms_actions/show_all', :owner => @investigation, :show_btn => false%>
          <%=render '/recommendations/show_all', :owner => @investigation, :show_btn => false%>

          <%=render "/ims/show_contact",
            :owner => @investigation,
            :fields => Contact.get_meta_fields('show')%>

          <%=render "/ims/show_task",
            :owner=>@investigation,
            :fields=> SmsTask.get_meta_fields('show')%>

          <%=render "/sms_actions/cost", :owner => @investigation%>


          <%#=render "/records/show_template_fields", :record => @investigation.record%>

          <%=render "/forms/show_comment", :owner => @investigation%>
          <%=render "/forms/attachments_show", :owner => @investigation%>
          <%=render "/records/transactions", :owner => @investigation%>
        </div>
      </div>
    </div>
  </div>
</div>



<style>
  .datepicker{
    z-index: 1200!important;
  }
</style>



<script>
  $(document).ready(function(){
    $('#att_btn').on('click',function(){
      $.get("<%=new_attachment_investigation_path(@investigation)%>",function(data){
        $(".modal-content").html(data);
        $(window).trigger('resize');
      });
    });
    $('#mitigate_btn').on('click',function(){
      $.get("<%=mitigate_investigation_path(@investigation)%>",function(data){
        $(".modal-content").html(data);
        $(window).trigger('resize');
      });
    });
    $('#baseline_btn').on('click',function(){
      $.get("<%=baseline_investigation_path(@investigation)%>",function(data){
        $(".modal-content").html(data);
        $(window).trigger('resize');
      });
    });
    $('#item_table').dataTable();
  });
</script>
