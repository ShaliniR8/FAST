<%field_type            = field_hash[:type]%>
<%field_description     = field_hash[:title]%>

<%field_name            = field_hash[:field]%>
<%field_value           = field_name.present? ? record.send(field_name) : ''%>
<%field_display         = field_hash[:display]%>
<%field_values          = field_hash[:values].present? ? record.send(field_hash[:values]) : ''%>
<%field_col             = field_hash[:num_cols] rescue '6'%>


<%if field_type == 'textarea'%>
  <%if field_value.present?%>
    <%=field_value.gsub(/\n/, '<br/>').html_safe%>
  <%end%>

<%elsif field_type == 'checklist'%>
  N/A

<%elsif field_type == 'checkbox'%>
  <%if field_value.present?%>
    <%field_value.reject(&:empty?).each do |x|%>
      <div class="col-xs-6">
        <span class="glyphicon glyphicon-check" aria-hidden="true"></span>
        <%=x%>
      </div>
    <%end%>
  <%end%>

<%else%>
  <%if field_value.to_s.present?%>
    <%case field_type%>
    <%when "boolean"%>
      <%boolean_options = {true => "Yes", false => "No"}%>
      <%=boolean_options[field_value]%>
    <%when "boolean_box"%>
      <%=field_value ? "Yes" : ""%>
    <%when "date"%>
      <% field_value = field_value.in_time_zone(record.event_time_zone) if record.class.name == 'Record' && record.event_time_zone.present? %>
      <%=date_to_string(field_value)%>
    <%when "datetime"%>
      <%event_date_field = field_name == 'event_date'%>
      <%if CONFIG.sr::GENERAL[:submission_time_zone]%>
        <%if event_date_field && record.event_time_zone.present?%>
          <%=display_date_time_in_zone(date_time: field_value, time_zone: record.event_time_zone)%>
        <%elsif event_date_field%>
          <%=display_date_time_in_zone(date_time: field_value, time_zone: 'UTC')%>
        <%else%>
          <%=datetime_to_string(field_value)%>
        <%end%>
      <%else%>
        <%if event_date_field%>
          <%=datetime_to_string(field_value) + " #{record.event_time_zone}"%>
        <%else%>
          <%=datetime_to_string(field_value)%>
        <%end%>
      <%end%>
    <%when "user"%>
      <%=User.find(field_value).full_name rescue field_value.to_s%>
    <%when "select"%>
      <%if field_display.present?%>
        <%=field_display[field_value]%>
      <%else%>
        <%=field_value%>
      <%end%>
    <%else%>
      <%if field_description == 'Attachments'%>
        <% attachment_ids = field_value.scan(/\/uploads\/attachment\/name\/(\d+)/).map { |x| x.first.to_i } %>

        <% access_attachment = current_user.has_access('reports', 'show', admin: CONFIG::GENERAL[:global_admin_default], strict: true) %>
        <% if access_attachment %>
          <%=field_value%>
        <% else %>
          <% attachments = field_value.split(/br/).map { |str| str.match(/\<\/i\>(?<name>.*)\<\/a/)[:name] rescue nil}.compact.join('<br>') %>
          <%= "<b>Attachments:</b> <br>#{attachments}".html_safe %>
        <% end %>
      <% else %>
        <%=field_value%>
      <% end %>
    <%end%>
  <%end%>
<%end%>





<style type="text/css">
  .control-label {
    text-align: left !important;
  }
  .showbox {
    word-break: break-all;
    min-height: 40px;
    padding: 9px;
    background-color: white;
    border: 1px solid gainsboro;
  }
  .form-group {
    margin-bottom: 3px;
  }
</style>
