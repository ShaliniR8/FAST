
<%fields.each do |field_hash|%>

  <%field_type            = field_hash[:type]%>
  <%field_description     = field_hash[:title]%>

  <%field_name            = field_hash[:field]%>
  <%field_value           = field_name.present? ? record.send(field_name) : ''%>
  <%field_display         = field_hash[:display]%>
  <%field_col             = field_hash[:num_cols]%>
  <%field_values          = field_hash[:values].present? ? record.send(field_hash[:values]) : ''%>
  <%if field_type == "newline"%>
    <div class="col-xs-12"></div>
  <%elsif field_type == "panel_start"%>
    <div class="col-xs-12">
      <div class="panel panel-lightskyblue">
        <div class="panel-heading click-heading">
          <div class="panel-title">
            <b><%=field_description%></b>
            <span class="pull-right clickable">
              <i class="mt5 glyphicon glyphicon-chevron-up"></i>
            </span>
          </div>
        </div>
        <div class="panel-body" style="display:block">
          <div class="row">
  <%elsif field_type == "panel_end"%>
          </div>
        </div>
      </div>
    </div>
  <%else%>

  <%if field_type == 'textarea'%>
    <div class="form-group col-xs-<%=field_col%> <%=field_name%>">
      <b><%=field_description%>: </b></br>
      <%if field_value.present?%>
        <%=field_value.gsub(/\n/, '<br/>').html_safe%>
      <%end%>
    </div>

  <%elsif field_type == 'checkbox'%>
    <div class="form-group col-xs-<%=field_col%> <%=field_name%>">
      <b><%=field_description%>: </b></br>
      <%if field_value.present?%>
        <%field_value.reject(&:empty?).each do |x|%>
          <div class="col-xs-6">
            <span class="glyphicon glyphicon-check" aria-hidden="true"></span>
            <%=x%>
          </div>
        <%end%>
      <%end%>
    </div>
  <%else%>
    <div class="form-group col-xs-<%=field_col%> <%=field_name%> mb10">
      <%if @recurrence && field_description == 'Scheduled Completion Date' && CONFIG.sa::GENERAL[:days_to_complete_instead_of_date] %>
      <b>Days to Complete </b>
      <%else%>
      <b><%=field_description%> </b>
      <%end%>
      <%if field_value.to_s.present?%>
        <%case field_type%>
          <%when "boolean"%>
            <%boolean_options = {true => "Yes", false => "No"}%>
            <%=boolean_options[field_value]%>

          <%when "boolean_box"%>
            <%=(field_value || field_value == '1') ? "Yes" : "No"%>

          <%when "date"%>
            <% if CONFIG.sa::GENERAL[:days_to_complete_instead_of_date] && @recurrence && field_name == 'due_date' &&  %>
              <%= (@template.due_date.to_date - @recurrence.next_date.to_date).to_i %>
            <% else %>
              <%=date_to_string(field_value)%>
            <% end %>
          <%when "datetime"%>
            <%event_date_field = field_name == 'event_date'%>
            <%if CONFIG.sr::GENERAL[:submission_time_zone]%>
              <%if event_date_field && record.event_time_zone.present?%>
                <%=display_date_time_in_zone(date_time: field_value, time_zone: record.event_time_zone)%>
              <%elsif event_date_field%>
                <%=display_date_time_in_zone(date_time: field_value, time_zone: 'UTC')%>
              <% else %>
                <%=datetime_to_string(field_value)%>
              <% end %>
            <% else %>
              <%if event_date_field%>
                <%=datetime_to_string(field_value) + " #{record.event_time_zone}"%>
              <% else %>
                <%=datetime_to_string(field_value)%>
              <% end %>
            <% end %>

          <%when 'datetimez'%>
            <%=datetimez_to_string(field_value)%>

          <%when "user"%>
            <%=User.find(field_value).full_name rescue field_value.to_s%>

          <%when "select"%>
            <%if field_display.present?%>
              <%=field_display[field_value]%>
            <%else%>
              <%=field_value%>
            <%end%>

          <%else%>
            <%=field_value%>
          <%end%>

        <%end%>
      </div>
    <%end%>
  <%end%>

<%end%>


<style type="text/css">
  .control-label {
    text-align: left !important;
  }
  .showbox {
    word-break: break-all;
    min-height: 40px;
    padding: 9px;
    background-color: white;
    border: 1px solid gainsboro;
  }
  .form-group {
    margin-bottom: 3px;
  }
</style>
