<script type="text/javascript" src="/javascripts/utility/collapse-panel2.js"></script>
<script type="text/javascript" src="/javascripts/utility/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="/javascripts/utility/format-builder.js"></script>
<link rel="stylesheet" type="text/css" href="/stylesheets/datepicker.css"/>
<script type="text/javascript" src="/javascripts/utility/timezone-control.js"></script>
<script type="text/javascript" src="/javascripts/utility/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/javascripts/utility/dataTables.bootstrap.min.js"></script>
<script type="text/javascript" src="/javascripts/utility/dataTables.buttons.min.js"></script>
<link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap/dataTables.bootstrap.min.css"/>
<script type="text/javascript" src="/javascripts/utility/nested_fields.js"></script>
<script type="text/javascript" src="/javascripts/utility/validate-form.js"></script>
<script type="text/javascript" src="/javascripts/utility/delete.js"></script>
<script type="text/javascript" src="/javascripts/utility/extra_fields.js"></script>


<div class="item active mt50" style="height:auto;">
  <div class="grid per90 center-block">
    <div class="col-lg-12">
      <%=render "shared/alerts"%>
      <div class="panel panel-steelblue">
        <div class="panel-heading">
          <div class="panel-title">
            <div class="top_text">
              <b>Preview: <%=@template.name%> <%=@template.archive ? "(Archived)" : ""%></b>
            </div>
            <div class="top_buttons pull-right">
              <% if current_user.username == 'prosafet_admin' %>
                <%=link_to "Make a Copy",
                clone_template_path(@template),
                :class => "btn btn-info",
                confirm: 'Are you sure?'%>

                <%=link_to 'Delete',
                template_path(@template),
                :method => "delete",
                :disable_with => "Deleting...",
                :confirm => "Are you sure?",
                :class => "btn btn-danger"%>
              <% end%>
              <%=link_to "Expand All",
                "#",
                :class => "btn btn-default expandall"%>
              <%=link_to "Create Record",
                new_submission_path(:template => @template),
                :id => "record-btn",
                :class => "btn btn-success",
                :disable_with => "Redirecting..."%>
              <%=link_to "Edit Template",
                edit_template_path(@template),
                :id => "edit-btn",
                :class => "btn btn-warning",
                :disable_with => "Editing..."%>
              <%if current_user.global_admin?%>
                <%=link_to "Export",
                  export_template_path(@template, :format => "yaml"),
                  'data-toggle' => 'tooltip',
                  title: "Export Template as YAML",
                  :class => "btn btn-outline-warning"%>
              <%end%>
            </div>
          </div>
        </div>

        <div class="panel-body " id="form_body">
          <div class="col-xs-12 mb20">
            <b>Template Name: </b><%=@template.name%><br>
            <b>Descriptions: </b><%=@template.description%><br>
            <b>Allow Anonymous Submission: </b><%=@template.allow_anonymous? ? 'Yes' : 'No'%><br>
            <b>Last Updated: </b><%=@template.updated%><br>
          </div>

          <div class="col-xs-12 col-sm-2 mb20">
            <%=label_tag :submitted_by, 'Submitted By'%>
            <%=text_field_tag :submitted_by, current_user.full_name, class: 'form-control', disabled: true%>
          </div>

          <%if CONFIG.sr::GENERAL[:submission_description]%>
            <div class="col-xs-12 col-sm-4">
              <%=label_tag :event_title, 'Event Title'%>
              <%=text_field_tag :event_title, nil, class: 'form-control'%>
            </div>
          <%end%>

          <div class="col-xs-12 col-sm-4 mb20">
            <%=label_tag :event_date, 'Date and Time of Event'%>
            <%=text_field_tag :event_date, nil, class: 'form-control field-datetime'%>
          </div>

          <%if CONFIG.sr::GENERAL[:submission_time_zone]%>
            <div class="col-xs-12 col-sm-2 mb5">
              <%=label_tag :event_time_zone, "Time Zone"%>
              <div class="input-group">
                <%=select_tag :event_time_zone, options_for_select(ActiveSupport::TimeZone.all.map(&:name)), {include_blank: true, class: 'form-control tz atz toplevel_timezone'}%>
                <span class="input-group-addon tc">All</span>
              </div>
            </div>
          <%end%>

          <%@template.categories.where(deleted: false).order(:category_order).each do |cat|%>
            <%=render "category", :cat => cat%>
          <%end%>

        </div>
      </div>
    </div>
  </div>
</div>


<style>
  .checkbox,
  .radio{
    cursor: pointer;
    margin-top: 2px;
    margin-bottom: 2px;
  }
  .checkbox:hover {
    font-weight:bold;
  }
  .radio:hover {
    font-weight:bold;
  }
</style>

<script type="text/javascript">

  $(document).ready(function(){
    $('.required_field').each(function(){
      if ($(this).parents('.nested_field').css('display') != 'none'){
        update_titles($(this));
      }
    });
  });

  function update_titles(target){
    $(target).closest('div.category-panel').find('.panel-title').css("color", "red");
    $(target).closest('div.category-panel').find('.panel-title').value = "*" ;
  }

</script>

