<div id="pie_chart_div-<%=@field_name%>" style="width:'100%'"></div>
<div class="mr5" id="pie_chart_download" align="right"></div>

<script type="text/javascript">
  google.charts.load("current", {packages:["corechart"]});
  google.charts.setOnLoadCallback(drawPieChart);
  var colorArray = colorInterpolation(<%=@data.length%>);

  function drawPieChart(){
    $("pie_chart_div-<%=@field_name%>").html("");
    var data = new google.visualization.DataTable();
    data.addColumn("string", "Value");
    data.addColumn("number", "Count");
    data.addColumn({type: "string", role: "tooltip"});
    data.addColumn({type: "string", role: "annotationText"});
    data.addColumn({type: "string", role: "style"});
    data.addRows([
      <%@data.each_with_index do |(k, v), index|%>
        [<%="'#{k}', #{v}, '#{k}', '#{k}',"%> colorArray[<%=index%>]],
      <%end%>]);

    var view = new google.visualization.DataView(data);
    view.setColumns([0, 1,
      { calc: "stringify",
        sourceColumn: 1,
        type: "string",
        role: "annotation"
      }, 2, 3, 4]);
    var options = {
      height: 500,
      title: "Analytics of <%=@field.label%>",
      titleTextStyle: {color: "black", fontSize: 18, bold: true},
      legend: {position: 'labeled'},
      colors: colorArray,
      pieSliceTextStyle: { color: 'black'},
      pieSliceText: 'annotationText',
      chartArea: {  height: "40%", width: "95%" },
      tooltip: {textStyle: {color: 'black'}, showColorCode: true},
    };
    var pieChart = new google.visualization.PieChart(document.getElementById('pie_chart_div-<%=@field_name%>'));

    google.visualization.events.addListener(pieChart, 'ready', function () {
      document.getElementById('pie_chart_download').innerHTML = '<a href="' + pieChart.getImageURI() + '"download><u>Download Chart</u></a>';
    });
    pieChart.draw(view, options);
  }

  $(window).bind('resizeEnd', function(){
    drawBarChart();
    drawPieChart();
  });

</script>
