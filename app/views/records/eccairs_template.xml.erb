<?xml version="1.0" encoding="utf-8"?>
<SET xmlns="http://eccairsportal.jrc.ec.europa.eu/ECCAIRS5_dataBridge.xsd" Version="1.0.0.0" Domain="RIT" TaxonomyVersion="4.1.0.7" TaxonomyName="ECCAIRS Aviation">
  <Occurrence>
    <%if attributes.length > 0%>
    <ATTRIBUTES>
      <%attributes.sort_by(&:attribute_sequence).each do |attribute|%>
        <%
          field_value = field_content[attribute].get_eccairs_value rescue nil
          conversion = DefaultIntegrationConfig::ECCAIRS_Preferences[:datatype_dictionary][attribute.datatype_id]
          field_value = (eval("'#{field_value}'.#{conversion}") rescue nil) if !conversion.nil? && !field_value.nil?
        %>
        <%if field_value.present?%>
          <%unit = attribute.eccairs_unit.present? ? attribute.eccairs_unit.unit_synonym : nil%>
          <%if unit.present?%>
      <<%=attribute.attribute_synonym%> Unit="<%=unit%>"><%=field_value%></<%=attribute.attribute_synonym%>>
          <%else%>
            <%if attribute.datatype_id == 6%>
      <Narrative_Language>16</Narrative_Language>
      <<%=attribute.attribute_synonym%>>
        <PlainText xmlns="http://eccairsportal.jrc.ec.europa.eu/ECCAIRS5_dataTypes.xsd"><%=field_value%></PlainText>
      </<%=attribute.attribute_synonym%>>
            <%else%>
      <<%=attribute.attribute_synonym%>><%=field_value%></<%=attribute.attribute_synonym%>>
            <%end%>
          <%end%>
        <%end%>
      <%end%>
    </ATTRIBUTES>
    <%end%>

    <%if entities.length > 0%>
    <ENTITIES>
      <%entities.each do |entity_name, inner_attributes|%>
      <<%=entity_name%>>
        <ATTRIBUTES>
          <%inner_attributes.sort_by(&:attribute_sequence).each do |attribute|%>
            <%
              field_value = field_content[attribute].get_eccairs_value rescue nil
              conversion = DefaultIntegrationConfig::ECCAIRS_Preferences[:datatype_dictionary][attribute.datatype_id]
              field_value = (eval("'#{field_value}'.#{conversion}") rescue nil) if !conversion.nil? && !field_value.nil?
            %>
            <%if field_value.present?%>
              <%unit = attribute.eccairs_unit.present? ? attribute.eccairs_unit.unit_synonym : nil%>
              <%if unit.present?%>
          <<%=attribute.attribute_synonym%> Unit="<%=unit%>"><%=field_value%></<%=attribute.attribute_synonym%>>
              <%else%>
                <%if attribute.datatype_id == 6%>
          <Narrative_Language>16</Narrative_Language>
          <<%=attribute.attribute_synonym%>>
            <PlainText xmlns="http://eccairsportal.jrc.ec.europa.eu/ECCAIRS5_dataTypes.xsd"><%=field_value%></PlainText>
          </<%=attribute.attribute_synonym%>>
                <%else%>
          <<%=attribute.attribute_synonym%>><%=field_value%></<%=attribute.attribute_synonym%>>
                <%end%>
              <%end%>
            <%end%>
          <%end%>
        </ATTRIBUTES>
      </<%=entity_name%>>
      <%end%>
    </ENTITIES>
    <%end%>

  </Occurrence>
</SET>
