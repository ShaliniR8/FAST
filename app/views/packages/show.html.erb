<script type="text/javascript" src="/javascripts/utility/collapse-panel2.js"></script>
<script type="text/javascript" src="/javascripts/utility/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/javascripts/utility/dataTables.bootstrap.min.js"></script>
<script type="text/javascript" src="/javascripts/utility/dataTables.buttons.min.js"></script>
<link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap/dataTables.bootstrap.min.css"/>
<div class="item active mt50" style="height:auto;">
	<div class="grid per90 center-block">
    <%= render "shared/alerts" %>
   	<div class="panel panel-primary">
     	<div class="panel-heading">
     		<div class="panel-title">
          <div class="top_text">
       		 <b><%="#{@package.class.display_name} ##{@package.get_id}: #{@package.title}"%></b>
          </div>
          <div class="top_buttons pull-right">

            <%if current_user.has_access('packages', 'destroy')%>
              <%=link_to "Delete",package_path(@package),:method=>"delete",:confirm=>'Please confirm that you want to delete. The deletion cannot be reverted',:class=>"btn btn-danger pull-right mb5"%>
            <%end%>

            <%if current_user.has_access('packages', 'edit')%>
              <%=link_to "Edit",edit_package_path(@package),:class=>"btn btn-warning pull-right mr5 mb5"%>
            <%end%>

            <%=link_to "PDF",print_package_path(@package,format: :pdf),:class=>"btn btn-info pull-right mr5 mb5"%>
            <%if @package.meeting.present?%>
              <%=link_to "View Meeting",sms_meeting_path(@package.meeting),:class=>"btn btn-info mr5 pull-right mb5"%>
            <%end%>
            <%if @package.class.display_name == "VP/Part 5 IM Package" && @package.item.present? && @package.item.im.present?%>
              <%=link_to "View VP/Part 5 IM", im_path(@package.item.im),:class=>"btn btn-info mr5 pull-right mb5"%>
            <%elsif @package.class.display_name == "Job Aid Package"  && @package.item.present? && @package.item.im.present?%>
              <%=link_to "View Job Aid", im_path(@package.item.im),:class=>"btn btn-info mr5 pull-right mb5"%>
            <%elsif @package.class.display_name == "Framework IM Package" && @package.item.present? && @package.item.im.present?%>
              <%=link_to "View Framework IM", im_path(@package.item.im),:class=>"btn btn-info mr5 pull-right mb5"%>
            <%end%>
            <%=link_to "Send Message",new_message_path(:link=>package_path(@package), :link_type=>"Package", :link_id=>@package.id),:class=>"btn btn-warning pull-right mr5 mb5"%>
            <%=link_to "Expand All","#",:class=>"btn btn-warning mr5 expandall pull-right mb5"%>
          </div>
     		</div>
     	</div>
     	<div class="panel-body">
        <div class="row">
          <div class="col-xs-12 mb15">
            <%if current_user.has_access('packages', 'edit')%>
              <%if @package.status=="Awaiting Review" %>
                <%=link_to "Complete",close_package_path(@package),:class=>"btn btn-warning mr5 pull-right mb5"%>
              <%end%>
            <%end%>
          </div>
          <%=render "access_controls/new_modal"%>
          <div class='col-xs-10'>
            <b>ID: </b><%=@package.get_id%>
          </div>
          <div class='col-xs-10'>
            <b>Status: </b><%=@package.status%>
          </div>

          <%@fields.each do |field|%>
            <%if field[:long_text]%>
              <div class='col-xs-12'>
                <b><%=field[:title]%>: </b></br>
                <div class="col-xs-11 col-xs-offset-1">
                  <%if @package.send(field[:field]).present?%><%=@package.send(field[:field]).gsub(/\n/, '<br/>').html_safe%><%end%>
                </div>
              </div>
            <%else%>
              <div class="col-xs-<%=field[:size]%>">
                <b><%=field[:title]%>: </b><%=@package.send(field[:field])%>
              </div>
            <%end%>
          <%end%>

          <%if @package.item.present?%>
            <div class="col-xs-12 col-lg-12 mt5"%>
              <div class="panel panel-info">
                <div class="panel-heading click-heading collapsed">
                  <div class="panel-title">
                    <b>Expectation: <%=@package.item.title%></b><span class="pull-right clickable"><i class="mt5 glyphicon glyphicon-chevron-down"></i></span>
                  </div>
                </div>
                <div class="panel-body mt5" style="display:none">
                  <div class="row">
                    <%=render "expectation",:item=>@package.item%>
                  </div>
                </div>
              </div>
            </div>
          <%end%>
          <%if @package.sms_agendas.present?%>
            <%=render "agendas"%>
          <%end%>
          <%=render "/forms/attachments_show", :owner => @package%>
          <%=render "/records/transactions",{:owner=>@package}%>
        </div>
      </div>
    </div>
	</div>
</div>
<style>
 .datepicker{
  z-index: 1200!important;
 }
</style>
<script>
  $(document).ready(function(){
    $('#att_btn').on('click',function(){
      $.get("<%=new_attachment_package_path(@package)%>",function(data){
        $(".modal-content").html(data);
        $(window).trigger('resize');
      });
    });
  });
</script>
