<script type="text/javascript" src="/javascripts/utility/collapse-panel2.js"></script>
<script type="text/javascript" src="/javascripts/utility/format-builder.js"></script>
<script type="text/javascript" src="/javascripts/utility/jquery.dataTables.min.js"></script>


<%=render "access_controls/new_modal"%>

<div class="item active mt50" style="height:auto;">
  <div class="grid per90 center-block">
    <%=render "shared/alerts"%>
    <div class="panel panel-primary">
      <div class="panel-heading">
        <div class="panel-title">
          <div class="top_text">
            Corrective Action #<%=@owner.get_id%>: <%=@owner.title%>
          </div>
          <div class="top_buttons pull-right">
            <%= render '/forms/btns/render_btns',
              btns: [
                'delete',
                'override_status',
                'edit',
                'deid_pdf',
                'pdf',
                'view_parent',
                # 'set_alert', #PENDING COMPLETION OF Notices<=Notifications Update
                'send_message',
                'expand_all'
              ],
              owner: @owner %>
          </div>
        </div>
      </div>

      <div class="panel-body">
        <div class="col-xs-12 mb15">
          <%= render 'forms/btns/render_btns',
            btns: [
              'assign',
              'complete',
              'request_extension',
              'schedule_validation',
              'cost',
              'approve_reject',
              'reopen',
              'comment'
            ],
            owner: @owner %>
          <%if @owner.status == "New" && !@owner.can_assign?(current_user)%>
            <b style='color:red;'>*Please complete the Source of Input before assigning the Corrective Action.</b>
          <%end%>
        </div>

        <%=render "/sms_actions/show", :owner => @owner, :show_btn => true%>
        <%=render "/forms/show_comment", :owner => @owner%>
        <%=render "/forms/attachments_show", :owner => @owner%>
        <%=render "/records/transactions", :owner => @owner%>

      </div>
    </div>
  </div>
</div>


<style>
  .datepicker{
    z-index: 1200!important;
  }
</style>


<script>
  $(document).ready(function(){

    $("#reassign_btn").on('click',function(){
      $.get("<%=reassign_sms_action_path(@owner)%>",
        function(data){
        $(".modal-content").html(data);
        $(window).trigger('resize');
      });
    });

    $('#att_btn').on('click',function(){
      $.get("<%=new_attachment_sms_action_path(@owner)%>",
        function(data){
        $(".modal-content").html(data);
        $(window).trigger('resize');
      });
    });

    $('#mitigate_btn').on('click', function(){
      $.get("<%=mitigate_sms_action_path(@owner)%>",
        function(data){
        $(".modal-content").html(data);
        $(window).trigger('resize');
      });
    });

    $('#baseline_btn').on('click', function(){
      $.get("<%=baseline_sms_action_path(@owner)%>",
        function(data){
        $(".modal-content").html(data);
        $(window).trigger('resize');
      });
    });

  });
</script>
