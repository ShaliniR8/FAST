<script type="text/javascript" src="/javascripts/utility/extra_fields.js"></script>
<script type="text/javascript" src="/javascripts/utility/format-builder.js"></script>

<%=form_for @record do |f|%>

	<%=f.hidden_field :object_type, :value => @object_type%>
	<%=f.hidden_field :created_by, :value => current_user.id%>

	<div class="col-xs-3">
		<%=f.label :anchor_date_field, "Anchor Date", :class => 'required_label'%>
		<%=f.select :anchor_date_field, 
			options_for_select(@anchor_date_fields, @record.anchor_date_field), 
			{:include_blank => ""}, 
			{:class => 'form-control required_field', :id => "object_type_select"}%>
	</div>

	<div class="col-xs-3">
		<%=f.label :anchor_status, "Anchor Status", :class => 'required_label'%>
		<%=f.select :anchor_status, 
			options_for_select(@anchor_status, @record.anchor_status), 
			{:include_blank => ""}, 
			{:class => 'form-control required_field', :id => "object_type_select"}%>
	</div>

	<div class="col-xs-3">
		<%=f.label :audience_field, "Audience", :class => 'required_label'%>
		<%=f.select :audience_field, 
			options_for_select(@audience_fields, @record.audience_field), 
			{:include_blank => ""}, 
			{:class => 'form-control required_field', :id => "object_type_select"}%>
	</div>

	<div class="col-xs-3">
		<%=f.label :interval, "Interval (Days)", :class => 'required_label'%>
		<%=f.number_field :interval, 
			:class => 'form-control required_field'%>
	</div>

	<div class="col-xs-6 mt10">
		<%if BaseConfig.airline[:enable_message_templates]%>
			<%=label_tag "template", "Template"%>
			<%=select_tag "template", 
				options_for_select(CannedMessage.all.collect{|p| [p["name"], p["id"]]}), 
				{:include_blank => true, 
				:class => "form-control template"}%>
		<%end%>
	</div>


	<div class="col-xs-12 mt10">
		<%=f.label :subject, "Subject", :class => 'required_label'%>
		<%=f.text_field 	:subject, :class => "form-control required_field"%>
	</div>

	<div class="col-xs-12 mt10">
		<%=f.label :content, "Content", :class => 'required_label'%>
		<%=f.text_area 	:content, 
			:class => "form-control required_field", 
			:rows => 4%>
	</div>

	<div class="col-xs-12 mr5 mt20">
		<%=f.submit 'Save', :class => "btn btn-success pull-right", :disable_with => 'Saving...'%>
		<%if action_name == 'edit'%>
			<%=link_to "Delete", 
				automated_notification_path(@record), 
				:method => "delete", 
				:confirm => 'Are you sure?',
				:class => "btn btn-danger pull-right mr5"%>
		<%end%>
	</div>

<%end%>



<script>
	$(function(){
		$(".template").on("change", function(){
			var message_template_id = $(this).val();
			$.get("<%=canned_messages_path%>/"+message_template_id, function(data){
				$("#automated_notification_content").val(data.data.content);
			});
		});
	});
</script>