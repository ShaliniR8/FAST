<div class="col-xs-12">
  <div class="panel panel-lightskyblue">
    <div class="panel-heading">
      <div class="panel-title">
        Add New Checklist
        <button type="button" class="close pull-right" data-dismiss="modal" aria-label="Close">
          <span class="glyphicon glyphicon-remove"></span>
        </button>
      </div>
    </div>
    <div class="panel-body" style="max-height:500px;overflow-y:auto;">
      <%if action_name == 'new'%>
        <div class="col-xs-6">
          <p>
            // TREVOR TODO <br>
            Explain that uploaded file should follow the header format.
            If no file is selected, empty checklist will be created. 
          </p>
          <%=label_tag :checklist_header, "Select a Checklist Header:"%>
          <%=select_tag :checklist_header,
            options_for_select(@checklist_headers),
            {:include_blank => "",
            :class => 'form-control',
            :id => "checklist_header_select"}%>
        </div>

        <%if @owner.present?%>
          <div class="col-xs-6">
            <p>
              // TREVOR TODO <br>
              Alternative is to create the template and use the template as the base.
            </p>
            <%=label_tag :checklist_template, "Select a Checklist Template:"%>
            <%=select_tag :checklist_template,
              options_for_select(@checklist_templates),
              {:include_blank => "",
              :class => 'form-control',
              :id => "checklist_template_select"}%>
          </div>
        <%end%>

        <div class="col-xs-12"><hr></div>
      <%else%>
      <%end%>
      <div class="col-xs-12" id="checklist_form"></div>
    </div>
  </div>
</div>



<style>
  .required_label:after{
    content: " *";
    color: red;
    display: inline;
  }
</style>



<script>
  function retract_header_form(checklist_header){
    var owner_type = "<%=(@owner.present?) ? @owner.class.name : 'ChecklistHeader'%>";
    var owner_id = "<%=@owner.id if @owner.present?%>";
    if (!owner_id) owner_id = checklist_header;
    $.get('<%=retract_form_upload_checklists_path%>?' +
      "owner_type=" + owner_type +
      "&owner_id=" + owner_id +
      "&checklist_header=" + checklist_header, function(data){
      $("#checklist_form").html(data);
      $(window).trigger('resize');
    });
  }

  function retract_template_form(template_id){
    $.get('<%=retract_form_template_checklists_path%>?' +
      "owner_type=<%=@owner.class.name rescue nil%>" +
      "&owner_id=<%=@owner.id rescue nil%>" +
      "&template_id=" + template_id, function(data){
      $("#checklist_form").html(data);
      $(window).trigger('resize');
    });
  }

  $(function(){
    $("#checklist_header_select").on("change", function(){
      retract_header_form($(this).val());
    });

    $("#checklist_template_select").on("change", function(){
      retract_template_form($(this).val());
    });

  });
</script>


