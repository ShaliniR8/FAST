swal({
  title: "New Root Cause",
  html: "<%= escape_javascript render('/root_causes/new_root_cause', first_id: first_id, second_id: second_id) %>",
  customClass: "custom-swal",
  showCancelButton: false,
  showConfirmButton: false,
  allowOutsideClick: true,
  onOpen: function(){

    <%if first_id.present?%>
      $(".cat_<%=@categories.first.level%> .cat_select option").each(function(){
        if($(this).val() == "<%=first_id%>") {
          $(this).prop("selected", true);
          update_options($('.cat_<%=@categories.first.level%> .cat_select'), <%=second_id%>);
          return true;
        }
      });
    <%end%>

    $('.cat_<%=@categories.first.level%> .cat_select').on('change',function(){
      update_options($(this), []);
    });

    // Update Root Cause section
    $.get("<%=reload_root_causes_hazard_path(@owner)%>", function(data){
      $("#root_causes_table").html(data);
    });


  }
}).catch(swal.noop);

function update_options(section, second_id){
  var level = parseInt("<%=@categories.first.level%>");
  $(".attributes").each(function(){
    if(parseInt($(section).attr("id")) >= level){
      $(section).html("");
    }
  });
  if ($(section).val() != ""){
    var additional_params = "";
    if(second_id != ""){
      additional_params = "&second_id=" + second_id
    }
    $.get("<%=retract_root_cause_categories_hazards_path%>?category=" + $(section).val() + additional_params, function(data){
      $("#<%=@categories.first.level%>").html(data);
    });
  }
}


