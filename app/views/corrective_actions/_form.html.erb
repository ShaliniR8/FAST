<script type="text/javascript" src="/javascripts/utility/format-builder.js"></script>
<script type="text/javascript" src="/javascripts/utility/timezone-control.js"></script>
<script type="text/javascript" src="/javascripts/utility/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/javascripts/utility/dataTables.bootstrap.min.js"></script>
<script type="text/javascript" src="/javascripts/utility/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="/javascripts/utility/nested_fields.js"></script>
<script type="text/javascript" src="/javascripts/utility/collapse-panel2.js"></script>
<script type="text/javascript" src="/javascripts/utility/validate-form.js"></script>
<script type="text/javascript" src="/javascripts/utility/delete.js"></script>
<script type="text/javascript" src="/javascripts/utility/extra_fields.js"></script>
<link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap/dataTables.bootstrap.min.css"/>
<div class="item active mt50" style="height:auto;">
  <div class="grid per90 center-block">
    <div class="panel panel-warning">
      <div class="panel-heading">
        <div class="panel-title">
          <%="#{action_name.titleize} Corrective Action"%>
        </div>
      </div>

      <div class="panel-body" id="form_body">
        <%= form_for @corrective_action,:html => {:multipart => true} do |f|%>
          <%= render partial: "shared/instructions", :locals => { :owner => @corrective_action, :action_name => action_name, :include_workflow_diagram => CONFIG.hierarchy[session[:mode]][:display_workflow_diagram] }%>
          <%if action_name == "new"%>
            <%=f.hidden_field :created_by_id, :value => current_user.id%>
          <%end%>
          <%=render "shared/privilege_form", :target => "corrective_action[privileges][]", :owner => @corrective_action, :f => f%>

          <%if params[:report].present?%>
            <%=f.hidden_field :reports_id, :value => @report.id%>
          <%end%>
          <%if params[:record].present?%>
            <%=f.hidden_field :records_id, :value => @record.id%>
          <%end%>
          <%if CONFIG.sr::GENERAL[:submission_corrective_action_root_cause].present? && params[:submission].present?%>
            <%=f.hidden_field :submissions_id, :value => @submission.id%>
          <%end%>

          <%=render "/forms/form_fields", :f => f, :fields => @fields, :record => @corrective_action%>
          <%=render '/forms/attachments_form', :f => f, :owner => @corrective_action%>

          <div class="mt10 mr10">
            <%= f.submit "#{action_name == 'new' ? 'Submit' : 'Update'}",
              :class => "btn btn-success pull-right",
              :disable_with => "Saving..."%>

            <%=link_to "Cancel",
              action_name == "edit" ? corrective_action_path(@corrective_action) : @report.present? ? report_path(@report) : record_path(@record),
              :id => "cancel-btn",
              :class => "mr5 btn btn-default pull-right",
              :confirm => 'Are you sure?'%>
            <%#=link_to "Group Access",
              "#",
              :class => "mr5 btn btn-info pull-right",
              "data-toggle" => "modal",
              "data-target" => "#group_access"%>
          </div>
        <%end%>
      </div>
    </div>
  </div>
</div>