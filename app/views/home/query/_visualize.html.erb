<div class="col-xs-6 visualization_box">
	<div class="panel panel-default">
		<div class="panel-heading">
			<div class="panel-title">
				<div class="top_text">
					Visualization
				</div>
				<div class="top_buttons pull-right">
					<%=link_to "<span class=\"glyphicon glyphicon-remove\"></span>".html_safe, 
						"#", 
						:class => "remove_btn btn btn-danger pull-right"%>
				</div>

			</div>
		</div>
		<div class="panel-body">
			<div class="row">
				<div class="col-xs-12">

					<div class="form-group col-xs-12 form-inline">
						<%=label_tag :select_field, "Select Field"%>
						<%=text_field_tag :field_id, nil, 
							{:list => "select_field", 
								:class => "form-control ml5", 
								:id => "field_select_all"}%>
						<datalist id="select_field">
							<% @fields.each do |x|%>
								<option value="<%=x[:title]%>"></option>
							<%end%>
						</datalist>
					</div>
						
					<div class="col-xs-12">
						<%=link_to "<span class=\"glyphicon glyphicon-refresh\"></span>".html_safe,
							"#",
							:class => "btn btn-info pull-right",
							:id => "generate_charts_btn"%>
					</div>
					
					<div id="chart_area"></div>

				</div>
			</div>
		</div>
	</div>
</div>




<script type="text/javascript"> 
	// Generate color interplation
	function colorInterpolation(steps){
		var colorArray = [];
		if(steps == 1){
			colorArray = ["red"]
		}else{
			var colorInterpolator = d3.interpolateRgb("red", "yellow");
			colorArray = d3.range(0, (1 + 1 / steps), 1 / (steps - 1)).map(function(d) {
				return colorInterpolator(d)
			});
		}
		return colorArray;
	}

	$(window).resize(function() {
		if(this.resizeTO) clearTimeout(this.resizeTO);
		this.resizeTO = setTimeout(function() {
			$(this).trigger('resizeEnd');
		}, 100);
	});

	$(document).ready(function(){

		$("#generate_charts_btn").on("click", function(e){
			$.get('<%=draw_chart_home_index_path%>?' + 
				'object_type=<%=@object_type%>' + 
				'&records_id=<%=@records.map(&:id).join(",")%>' + 
				'&field_id=' + encodeURIComponent($("#field_select_all").val()), function(data){
				$("#chart_area").html(data)
			});
		});

		$(document).delegate(".remove_btn", "click", function (){
		  $(this).closest('.visualization_box').remove();
		});


	});
</script>