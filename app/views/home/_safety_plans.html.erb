<div class="col-xs-12 col-sm-3">
	<div class="panel panel-danger">
		<div class="panel-heading">
			<div class="panel-title">
				<b>Safety Plans Statistics</b> 
			</div>
		</div>
		<div class="panel-body" style="height:300px">
			<div class="row">
				<div class="col-xs-12">
					<h4>Average Days to Complete: <%=SafetyPlan.get_avg_complete%></h4>
				</div>
			</div>
			<div id="safety_plans" style="width: 100%"></div>   
			<div id="safety_plans_download" style="width: 100%" align="right"></div> 
		</div>
	</div>
</div>
<script type="text/javascript">
	<%= render partial: "analytics_data.js.erb", locals: {type: :safety_plan} %>
	google.charts.load('current', {packages: ['corechart', 'bar']});
	google.charts.setOnLoadCallback(function() {drawChartsafety_plan(safetyPlanData);});
	function drawChartsafety_plan(data) {
		
		var safety_plan_options = {
			chart: {title: 'Safety Plan Statistics'},
			legend:'none',          
			height:230,
			colors:['blue'],
			bars: 'horizontal' ,
			chartArea: {left:100}// Required for Material Bar Charts.
		};

		var safety_plan_chart = new google.visualization.BarChart(document.getElementById('safety_plans'));
		google.visualization.events.addListener(safety_plan_chart, 'onmouseover', cursor_pointer);
		google.visualization.events.addListener(safety_plan_chart, 'onmouseout', cursor_default);
		google.visualization.events.addListener(safety_plan_chart, 'ready', function () {
			document.getElementById('safety_plans_download').innerHTML = '<a href="' + safety_plan_chart.getImageURI() + '"download><u>Download Chart</u></a>';
		});
		safety_plan_chart.draw(google.visualization.arrayToDataTable(data), safety_plan_options);  
		google.visualization.events.addListener(safety_plan_chart, 'select', function(){
			var all_status=<%=raw @safety_plans.keys%>
			var root_url="<%=safety_plans_path%>?status="
			var selection = safety_plan_chart.getSelection();
			var message = "";
			for (var i = 0; i < selection.length; i++) {
				var item = selection[i];
				message= root_url+all_status[item.row];
			}
			window.location=message;
		});
	}


	$(window).bind('resizeEnd', function() {
		drawChartsafety_plan(safetyPlanData);
	});
</script>