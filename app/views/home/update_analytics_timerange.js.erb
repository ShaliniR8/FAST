// console.log("start-date=", "<%=@start_date%>");
<%= render partial: "analytics_data.js.erb", locals: {type: :all} %>
// console.log("<%=session[:mode]%>");
var params = {
    startDate: "<%= @start_date %>",
    endDate: "<%= @end_date %>",
    <% if @emp_groups.present? %>employeeGroups: ['<%= @emp_groups.join("','") %>'] <% end %>
    <% if @departments.present? %>departments: ['<%= @departments.join("','") %>'] <% end %>
    <% if @feeder_operators.present? %>feederOperators: ['<%= @feeder_operators.join("','") %>'] <% end %>
}

// $("#calendar-parent").html("<%= escape_javascript(render('calendar')) %>");
$('#calendar').fullCalendar('removeEvents');
$('#calendar').fullCalendar('addEventSource', <%=raw(@calendar_entries.to_json)%>);
$('#calendar').fullCalendar('rerenderEvents' );

$('.baseline_matrix').html("<%= escape_javascript(render partial: 'risk_matrices/dashboard_matrix/baseline/matrix') %>");
$('.mitigate_matrix').html("<%= escape_javascript(render partial: 'risk_matrices/dashboard_matrix/mitigate/matrix') %>");

// console.log("params=", params);
<% if session[:mode] == "ASAP" %>
    $('#record_avg_days_to_complete').html("Average Days to Complete: <%=@records_scheduled_completion_date%>")
    $('#report_avg_days_to_complete').html("Average Days to Complete: <%=@reports_scheduled_completion_date%>")
    $('#ca_avg_days_to_complete').html("Average Days to Complete: <%=@corrective_actions_scheduled_completion_date%>")

    drawChartsubs(submissionData,   params);
    drawChart(recordData,           params, "records",         "records_download",         "<%= records_path %>");
    drawChart(reportData,           params, "reports",         "reports_download",         "<%= reports_path %>");
    drawChart(correctiveActionData, params, "cas",             "cas_download",             "<%= corrective_actions_path %>");
<% elsif session[:mode] == "SMS IM" %>
    drawChart(frameworkData,        params, "frameworks",      "frameworks_download",      "<%= ims_path %>", "FrameworkIm");
    drawChart(vpData,               params, "vps",             "vps_download",             "<%= ims_path %>", "VpIm");
    drawChart(jobaidData,           params, "jobaids",         "jobaids_download",         "<%= ims_path %>", "JobAid");
    drawChart(fpData,               params, "fp",              "fp_download",              "<%= packages_path %>", "FrameworkImPackage");
    drawChart(vppData,              params, "vpp",             "vpp_download",             "<%= packages_path%>", "VpImPackage");
    drawChart(japData,              params, "jap",             "jap_download",             "<%= packages_path %>", "JobAidPackage");
<% elsif session[:mode] == "SMS" %>
    $('#audit_avg_days_to_complete').html("Average Days to Complete: <%=Audit.get_avg_complete(nil, @start_date, @end_date)%>")
    $('#inspection_avg_days_to_complete').html("Average Days to Complete: <%=Inspection.get_avg_complete(nil, @start_date, @end_date)%>")
    $('#evaluation_avg_days_to_complete').html("Average Days to Complete: <%=Evaluation.get_avg_complete(nil, @start_date, @end_date)%>")
    $('#investigation_avg_days_to_complete').html("Average Days to Complete: <%=Investigation.get_avg_complete(nil, @start_date, @end_date)%>")
    $('#finding_avg_days_to_complete').html("Average Days to Complete: <%=Finding.get_avg_complete(nil, @start_date, @end_date)%>")
    $('#sms_action_avg_days_to_complete').html("Average Days to Complete: <%=SmsAction.get_avg_complete(nil, @start_date, @end_date)%>")
    $('#recommendation_avg_days_to_complete').html("Average Days to Complete: <%=Recommendation.get_avg_complete(nil, @start_date, @end_date)%>")
    
    drawChart(auditData,            params, "audits",          "audits_download",          "<%= audits_path %>");
    drawChart(inspectionData,       params, "inspections",     "inspections_download",     "<%= inspections_path %>");
    drawChart(evaluationData,       params, "evaluations",     "evaluations_download",     "<%= evaluations_path %>");
    drawChart(investigationData,    params, "investigations",  "investigations_download",  "<%= investigations_path %>");
    drawChart(findingData,          params, "findings",        "findings_download",        "<%= findings_path %>");
    drawChart(correctiveActionData, params, "actions",         "actions_download",         "<%= sms_actions_path %>");
    drawChart(recommendationData,   params, "recommendations", "recommendations_download", "<%= recommendations_path %>");
<% elsif session[:mode] == "SRM" %>
    $('#sra_avg_days_to_complete').html("Average Days to Complete: <%=Sra.get_avg_complete(nil, @start_date, @end_date, params[:departments])%>")
    $('#hazard_avg_days_to_complete').html("Average Days to Complete: <%=Hazard.get_avg_complete(nil, @start_date, @end_date, params[:departments])%>")
    $('#risk_control_avg_days_to_complete').html("Average Days to Complete: <%=RiskControl.get_avg_complete(nil, @start_date, @end_date, params[:departments])%>")
    $('#safety_plan_avg_days_to_complete').html("Average Days to Complete: <%=SafetyPlan.get_avg_complete(nil, @start_date, @end_date, params[:departments])%>")
    
    drawChart(sraData,              params, "sras",            "sras_download",            "<%= sras_path %>");
    drawChart(hazardData,           params, "hazards",         "hazards_download",         "<%= hazards_path %>");
    drawChart(riskControlData,          params, "risk_controls",   "risk_controls_download",   "<%= risk_controls_path %>");
    drawChart(safetyPlanData,       params, "safety_plans",    "safety_plans_download",    "<%= safety_plans_path %>");
<% elsif session[:mode] == "SP" %>
    drawChart(newsletterData,              params, "newsletters",            "newsletters_download",            "<%= newsletters_path %>");
    drawChart(safetySurveyData,            params, "safety_surveys",         "safety_surveys_download",         "<%= safety_surveys_path %>");
<% end %>
// console.log("start-date=", "<%=@start_date%>");
<% Rails.logger.debug "before render, start_date=#{@start_date}" %>
//$("#risk-matrix-parent").html('<%#= escape_javascript(render("risk_matrices/dashboard_matrix/risk_matrices"))%>')
