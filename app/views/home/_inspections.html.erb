<div class="col-xs-12 col-sm-3">
  <div class="panel panel-black">
    <div class="panel-heading">
      <div class="panel-title">
        <b>Inspections Statistics</b>
      </div>
    </div>
    <div class="panel-body" style="height:300px">
      <div class="row">
        <div class="col-xs-12">
          <h5 id='inspection_avg_days_to_complete'>Average Days to Complete: <%=Inspection.get_avg_complete(nil, @start_date, @end_date)%></h5>
        </div>
      </div>
      <div id="inspections" style="width: 100%"></div>
      <div id="inspections_download" style="width: 100%" align="right"></div>
    </div>
  </div>
</div>
<script type="text/javascript">
  <%= render partial: "analytics_data.js.erb", locals: {type: :inspection} %>
  google.charts.load('current', {packages: ['corechart', 'bar']});
  google.charts.setOnLoadCallback(function() {drawChart6(inspectionData, params);});
  function drawChart6(data, params) {
    var ins_options = {
      chart: {title: 'Safety Assurance Statistics'},
      legend:'none',
      height:230,
      colors:['blue'],
      bars: 'horizontal',
      chartArea: {left:100} // Required for Material Bar Charts.
    };

    var inspection_chart = new google.visualization.BarChart(document.getElementById('inspections'));
    google.visualization.events.addListener(inspection_chart, 'onmouseover', cursor_pointer);
    google.visualization.events.addListener(inspection_chart, 'onmouseout', cursor_default);
    google.visualization.events.addListener(inspection_chart, 'ready', function () {
      document.getElementById('inspections_download').innerHTML = '<a href="' + inspection_chart.getImageURI() + '"download><u>Download Chart</u></a>';
    });
    inspection_chart.draw(google.visualization.arrayToDataTable(data), ins_options);
    google.visualization.events.addListener(inspection_chart, 'select', function(){

      var all_status=<%=raw @grouped_inspections.keys%>
      var root_url="<%=inspections_path%>?status="
      var selection = inspection_chart.getSelection();
      var message = "";
      var dateParams = params ? "&start_date=" + params.startDate + "&end_date=" + params.endDate : "";
      for (var i = 0; i < selection.length; i++) {
        var item = selection[i];
        message= root_url+all_status[item.row] + dateParams;
      }
      window.location=message;
    });
  }
  $(window).bind('resizeEnd', function() {
    drawChart6(inspectionData, params);
  });
</script>
