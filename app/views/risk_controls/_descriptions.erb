<div class="col-xs-12 col-lg-12"%>
  <div class="panel panel-info">
    <div class="panel-heading click-heading collapsed">
      <div class="panel-title">
        <b>Descriptions</b><span class="pull-right clickable"><i class="mt5 glyphicon glyphicon-chevron-down"></i></span>
      </div>
    </div>
    <div class="panel-body" style="display:none">
      <div class="row">
        <div class="col-xs-12">
          <%if show_btns && (owner.status == "Open" || owner.status == "New") && current_user.has_access("Risk Control","edit")%>
            <%=link_to "Add Description",
              "#",
              :class=>"btn btn-success pull-right mr5",
              :id=>"desc_btn",
              "data-toggle"=>"modal",
              "data-target"=>".bs-example-modal-lg"%>
          <%end%>

          <table class="table table-striped table-bordered">
            <thead>
              <tr>
                <%headers.each do |h|%>
                  <th><%=h[:title]%></th>
                <%end%>
                <%if show_btns && (owner.status == "Open" || owner.status == "New") && current_user.has_access("Risk Control","edit")%>
                  <th>Action</th>
                <%end%>
              </tr>
            </thead>
            <tbody>
              <%owner.descriptions.each do |c|%>
                <tr>
                  <%headers.each do |h|%>
                    <td><%=c.send(h[:field])%></td>
                  <%end%>
                  <%if show_btns && (owner.status == "Open" || owner.status == "New") && current_user.has_access("Risk Control","edit")%>
                    <td><%=link_to "Delete",
                      "#",
                      :class=>"btn btn-danger delete_desc_btn",
                      "data-cid"=>c.id%></td>
                  <%end%>
                </tr>
              <%end%>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
    $("#desc_btn").on('click',function(){
      $.get("<%=new_descriptions_risk_control_path(owner)%>",function(data){
        $(".modal-content").html(data);
        $(window).trigger('resize');
      });
    });
    $('.delete_desc_btn').on('click',function(){
      btn=$(this);
      $.ajax({
        url : "<%=causes_path%>"+"/"+$(this).data('cid'),
        type : "delete",
        success: function(){
          btn.closest('tr').detach();
        }
      });
    });
</script>
