<%=
  javascript_include_tag(
    'utility/collapse-panel2'
  )
%>

<%=render "access_controls/new_modal"%>
<div class="item active mt50" style="height:auto;">
  <div class="grid per90 center-block">
    <div class="panel panel-primary">
      <div class="panel-heading">
        <div class="panel-title">
          <div class="top_text">
            Risk Control #<%=@risk_control.get_id%>: <%=@risk_control.title%>
          </div>

          <div class="top_buttons pull-right">
            <%= render '/forms/render_buttons', owner: @risk_control, env: :top %>
          </div>

        </div>
      </div>

      <div class="panel-body">
        <% if CONFIG::GENERAL[:display_workflow_diagram] %>
         <div class="col-xs-12">
            <%instruction = "<p>"
              instruction = instruction + "<button id ='toggleWorkflowImageButton' type='button' class='btn btn-light' >Show Workflow Image</button>"
              instruction = instruction + "</p>"
              instruction = instruction + "<img id='workflowImage' class = 'workflowImg' height=800 width= 100% >"
            %>
            <%=render "shared/instructions",
              :instruction => instruction%>
        </div>
        <% end %>
        <div class="col-xs-12 mb20">
          <%= render '/forms/render_buttons', owner: @risk_control, env: :inline %>
        </div>

        <%= render '/forms/show_fields', :fields => @fields, :record => @risk_control%>
        <%= render '/panels/show_panels', owner: @risk_control%>

      </div>
    </div>
  </div>
</div>

<style>
  #workflowImage{
    display: none;
  }
</style>

<script>
  $(document).ready(function(){
    $(".modal").on("hidden.bs.modal", function(){
      $(".modal-content").html("");
    });

    $('#att_btn').on('click',function(){
      $.get("<%=new_attachment_risk_control_path(@risk_control)%>",function(data){
        $(".modal-content").html(data);
        $(window).trigger('resize');
      });
    });

    <% if CONFIG::GENERAL[:display_workflow_diagram] %>
      <% status_field_name = CONFIG.srm::HIERARCHY[:objects][@risk_control.class.name][:fields][:status][:field]%>
      <% curr_status = @risk_control.send(status_field_name).downcase %>
      $("#workflowImage").attr('src', "<%=CONFIG.srm::HIERARCHY[:objects][@risk_control.class.name][:workflow_images].select {|key| curr_status.include? key}.values[0]%>")
    <% end %>

    $("#toggleWorkflowImageButton").on('click', function(event){
      event.preventDefault();
  
      if($("#workflowImage").is(":visible")){
        $("#workflowImage").delay(1).hide("slow")
        $("#toggleWorkflowImageButton").html("Show Workflow Image")
      }else{
        $("#workflowImage").delay(1).show("slow")
        $("#toggleWorkflowImageButton").html("Hide Workflow Image")
      }
    })


  });
</script>
