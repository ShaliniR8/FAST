<div class="panel panel-lightblue">
  <div class="panel-heading">
    <div class="panel-title">
      <div>
        <span class="top_text">Query Detail</span>
        <%= link_to(refresh_query_query_path(@owner),
                     method: :post,
                    :class => 'btn btn-primary pull-right ml10',
                    :id => 'query-refresh-btn') do %>
          <span class="glyphicon glyphicon-refresh"></span>
        <% end %>
        <span class="pull-right" id="query-processing-status"><%=@status_msg%></span>
      </div>
      <div class="top_buttons pull-right"></div>
    </div>
  </div>
  <div class="panel-body">

    <div class="tree">
      <div class="col-xs-12 mb20">
        <%=render '/forms/show_fields', :fields => @query_fields, :record => @owner%>
      </div>
      <ul>
        <%@owner.query_conditions.each_with_index do |condition, index|%>
          <%=render "condition", :condition => condition, :index => index%>
        <%end%>
      </ul>
    </div>
  </div>
</div>




<style>
  .condition_badge {
    font-size: 15px !important;
    border: none !important;
    color: black;
  }
  .tree {
    min-height:20px;
    padding:19px;
    margin-bottom:20px;
    background-color:white;
    -webkit-border-radius:4px;
    -moz-border-radius:4px;
    border-radius:4px;
    -webkit-box-shadow:inset 0 1px 1px rgba(0, 0, 0, 0.05);
    -moz-box-shadow:inset 0 1px 1px rgba(0, 0, 0, 0.05);
    box-shadow:inset 0 1px 1px rgba(0, 0, 0, 0.05)
  }
  .tree li {
    list-style-type:none;
    margin:0;
    padding:10px 5px 0 5px;
    position:relative
  }
  .tree li::before, .tree li::after {
    content:'';
    left:-20px;
    position:absolute;
    right:auto
  }
  .tree li::before {
    border-left:1px solid #999;
    bottom:50px;
    height:100%;
    top:0;
    width:1px
  }
  .tree li::after {
    border-top:1px solid #999;
    height:20px;
    top:25px;
    width:25px
  }
  .tree li span {
    -moz-border-radius:5px;
    -webkit-border-radius:5px;
    border:1px solid #999;
    border-radius:5px;
    display:inline-block;
    padding:3px 8px;
    text-decoration:none
  }
  .tree li.parent_li>span {
    cursor:pointer
  }
  .tree>ul>li::before, .tree>ul>li::after {
    border:0
  }
  .tree li:last-child::before {
    height:30px
  }
  .tree li.parent_li>span:hover, .tree li.parent_li>span:hover+ul li span {
    background:#eee;
    border:1px solid #94a0b4;
    color:#000
  }
  #query-processing-status {
    color: gray;
  }
</style>

<script type="text/javascript">
  $(document).ready(function() {

    if ("<%=@query_status%>" === "new") {
      // Disable the refresh page while processing the rake task
      document.getElementById('query-refresh-btn').classList.add("disabled")

      // queryProcessingStatus = document.getElementById('query-processing-status');

      // setInterval(function() {
      //   queryProcessingStatus.style.visibility = (queryProcessingStatus.style.visibility == 'hidden' ? '' : 'hidden');
      // }, 1000);
    }
  })
</script>